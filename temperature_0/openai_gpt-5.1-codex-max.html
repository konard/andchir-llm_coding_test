<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris</title>
<style>
:root{
  --bg:#0f172a;
  --panel:#111827;
  --accent:#06b6d4;
  --text:#e2e8f0;
  --shadow:0 10px 30px rgba(0,0,0,.4);
  --grid:10;
}
*{box-sizing:border-box;}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at 20% 20%,#111827 0%,#0b1329 30%,#0a0f22 60%,#070b17 100%);
  font-family:'Inter',system-ui,-apple-system,sans-serif;
  color:var(--text);
}
.wrapper{
  width:100%;
  max-width:720px;
  padding:16px;
}
.game{
  background:linear-gradient(145deg,#0f172a 0%,#0b1526 100%);
  border:1px solid rgba(255,255,255,.05);
  border-radius:20px;
  box-shadow:var(--shadow);
  padding:16px;
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:16px;
}
@media(max-width:768px){
  .game{grid-template-columns:1fr;}
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:8px;
}
.title{
  font-size:20px;
  font-weight:700;
  letter-spacing:.02em;
  display:flex;
  align-items:center;
  gap:8px;
}
.badge{
  padding:4px 10px;
  border-radius:999px;
  background:rgba(6,182,212,.12);
  color:var(--accent);
  font-size:12px;
  font-weight:600;
}
.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
button{
  border:none;
  cursor:pointer;
  color:var(--text);
  background:linear-gradient(145deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;
  padding:10px 14px;
  font-weight:600;
  letter-spacing:.01em;
  transition:transform .1s,box-shadow .2s,background .2s;
  box-shadow:0 8px 20px rgba(0,0,0,.3);
}
button:hover{transform:translateY(-1px);}
button:active{transform:translateY(0);}
button.primary{
  background:linear-gradient(135deg,#06b6d4,#22d3ee);
  color:#0b1221;
}
.panel{
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.04);
  border-radius:12px;
  padding:12px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);
}
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:8px;
}
.stat{
  background:rgba(0,0,0,.2);
  border:1px solid rgba(255,255,255,.04);
  border-radius:10px;
  padding:10px 12px;
}
.stat label{
  display:block;
  font-size:12px;
  opacity:.7;
}
.stat .value{
  font-size:20px;
  font-weight:700;
  margin-top:4px;
}
.board-wrap{
  position:relative;
  display:flex;
  justify-content:center;
}
#board{
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(255,255,255,.04);
  border-radius:14px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.05),0 10px 30px rgba(0,0,0,.5);
  width:100%;
  max-width:420px;
  aspect-ratio:10/20;
  image-rendering:pixelated;
}
.next-wrap{
  display:flex;
  gap:12px;
}
#next{
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.01));
  border:1px solid rgba(255,255,255,.04);
  border-radius:10px;
  width:120px;
  aspect-ratio:4/4;
}
.mobile-controls{
  margin-top:12px;
  display:none;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
@media(max-width:768px){
  .mobile-controls{display:flex;}
}
.mobile-btn{
  flex:1 1 30%;
  min-width:90px;
  padding:12px;
  font-size:14px;
}
.footer{
  text-align:center;
  margin-top:8px;
  font-size:12px;
  opacity:.5;
  letter-spacing:.02em;
  user-select:none;
}
</style>
</head>
<body>
<div class="wrapper">
  <div class="game">
    <div>
      <div class="header">
        <div class="title">TETRIS <span class="badge">CLASSIC</span></div>
        <div class="controls">
          <button id="startBtn" class="primary">–°—Ç–∞—Ä—Ç / –°–±—Ä–æ—Å</button>
          <button id="pauseBtn">–ü–∞—É–∑–∞</button>
        </div>
      </div>
      <div class="board-wrap">
        <canvas id="board"></canvas>
      </div>
      <div class="mobile-controls">
        <button class="mobile-btn" data-action="left">‚óÄÔ∏è –í–ª–µ–≤–æ</button>
        <button class="mobile-btn" data-action="rotate">üîÑ –ü–æ–≤–æ—Ä–æ—Ç</button>
        <button class="mobile-btn" data-action="right">‚ñ∂Ô∏è –í–ø—Ä–∞–≤–æ</button>
        <button class="mobile-btn" data-action="down">‚¨áÔ∏è –í–Ω–∏–∑</button>
        <button class="mobile-btn" data-action="drop">‚è¨ –°–±—Ä–æ—Å</button>
      </div>
    </div>
    <div class="panel">
      <div class="stats">
        <div class="stat"><label>–û—á–∫–∏</label><div class="value" id="score">0</div></div>
        <div class="stat"><label>–õ–∏–Ω–∏–∏</label><div class="value" id="lines">0</div></div>
        <div class="stat"><label>–£—Ä–æ–≤–µ–Ω—å</label><div class="value" id="level">1</div></div>
      </div>
      <div style="margin-top:12px;">
        <label style="font-size:12px;opacity:.7;">–°–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞</label>
        <div class="next-wrap">
          <canvas id="next"></canvas>
        </div>
      </div>
      <div class="footer">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ‚Üê ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, ‚Üë –ø–æ–≤–æ—Ä–æ—Ç, ‚Üì —É—Å–∫–æ—Ä–µ–Ω–∏–µ, Space ‚Äî —Å–±—Ä–æ—Å</div>
    </div>
  </div>
</div>
<script>
(() => {
  const canvas = document.getElementById('board');
  const nextCanvas = document.getElementById('next');
  const ctx = canvas.getContext('2d');
  const nctx = nextCanvas.getContext('2d');
  let cols = 10, rows = 20;
  let cell = 24;
  const colors = {
    'I':'#22d3ee',
    'J':'#3b82f6',
    'L':'#f59e0b',
    'O':'#fcd34d',
    'S':'#10b981',
    'T':'#a855f7',
    'Z':'#ef4444'
  };
  const shapes = {
    'I':[[0,1],[1,1],[2,1],[3,1]],
    'J':[[0,0],[0,1],[1,1],[2,1]],
    'L':[[2,0],[0,1],[1,1],[2,1]],
    'O':[[1,0],[2,0],[1,1],[2,1]],
    'S':[[1,0],[2,0],[0,1],[1,1]],
    'T':[[1,0],[0,1],[1,1],[2,1]],
    'Z':[[0,0],[1,0],[1,1],[2,1]],
  };
  let arena, piece, nextPiece;
  let dropCounter = 0;
  let dropInterval = 800;
  let lastTime = 0;
  let paused = false;
  let score = 0, lines = 0, level = 1;
  let bag = [];

  function resizeCanvas(){
    const maxW = Math.min(window.innerWidth*0.9,420);
    const scale = Math.floor(maxW/cols);
    cell = Math.max(16,scale);
    canvas.width = cols*cell;
    canvas.height = rows*cell;
    nextCanvas.width = 4*cell;
    nextCanvas.height = 4*cell;
    draw();
  }

  function createMatrix(w,h){
    const m=[];
    while(h--) m.push(new Array(w).fill(0));
    return m;
  }

  function newBag(){
    const keys = Object.keys(shapes);
    for(let i=keys.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [keys[i],keys[j]]=[keys[j],keys[i]];
    }
    bag = keys.slice();
  }

  function nextRandomPiece(){
    if(bag.length===0) newBag();
    const type = bag.pop();
    const pos = {x:3,y:0};
    const blocks = shapes[type].map(p=>p.slice());
    return {type,blocks,pos};
  }

  function rotate(piece,dir=1){
    piece.blocks.forEach(p=>{
      const tmp = p[0];
      p[0] = dir ? -p[1] : p[1];
      p[1] = dir ? tmp : -tmp;
    });
  }

  function collide(arena,piece){
    for(const b of piece.blocks){
      const x = b[0]+piece.pos.x;
      const y = b[1]+piece.pos.y;
      if(y<0) continue;
      if(x<0 || x>=cols || y>=rows || arena[y][x]) return true;
    }
    return false;
  }

  function merge(arena,piece){
    for(const b of piece.blocks){
      const x = b[0]+piece.pos.x;
      const y = b[1]+piece.pos.y;
      if(y>=0) arena[y][x]=piece.type;
    }
  }

  function clearLines(){
    let rowCount = 0;
    outer: for(let y=rows-1;y>=0;y--){
      for(let x=0;x<cols;x++){
        if(!arena[y][x]) continue outer;
      }
      const row = arena.splice(y,1)[0].fill(0);
      arena.unshift(row);
      y++;
      rowCount++;
    }
    if(rowCount>0){
      const pts = [0,40,100,300,1200][rowCount];
      score += pts*level;
      lines += rowCount;
      if(lines>=level*10){
        level++;
        dropInterval = Math.max(100, dropInterval - 70);
      }
      updateStats();
    }
  }

  function updateStats(){
    document.getElementById('score').textContent=score;
    document.getElementById('lines').textContent=lines;
    document.getElementById('level').textContent=level;
  }

  function drawCell(x,y,color,ctxRef=ctx){
    ctxRef.fillStyle=color;
    ctxRef.fillRect(x*cell,y*cell,cell,cell);
    ctxRef.strokeStyle='rgba(0,0,0,.18)';
    ctxRef.lineWidth=1;
    ctxRef.strokeRect(x*cell+0.5,y*cell+0.5,cell-1,cell-1);
    const grad = ctxRef.createLinearGradient(x*cell,y*cell,x*cell,y*cell+cell);
    grad.addColorStop(0,'rgba(255,255,255,.18)');
    grad.addColorStop(1,'rgba(255,255,255,.02)');
    ctxRef.fillStyle=grad;
    ctxRef.fillRect(x*cell,y*cell,cell,cell);
  }

  function drawMatrix(matrix,offset,color){
    matrix.forEach((val,y)=>{
      val.forEach((t,x)=>{
        if(t){
          drawCell(x+offset.x,y+offset.y,color);
        }
      });
    });
  }

  function draw(){
    ctx.fillStyle='rgba(0,0,0,.35)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<rows;y++){
      for(let x=0;x<cols;x++){
        if(arena[y][x]){
          drawCell(x,y,colors[arena[y][x]]);
        }else{
          ctx.strokeStyle='rgba(255,255,255,.04)';
          ctx.strokeRect(x*cell+0.5,y*cell+0.5,cell-1,cell-1);
        }
      }
    }
    piece.blocks.forEach(p=>{
      const x = p[0]+piece.pos.x;
      const y = p[1]+piece.pos.y;
      drawCell(x,y,colors[piece.type]);
    });
    drawNext();
  }

  function drawNext(){
    nctx.clearRect(0,0,nextCanvas.width,nextCanvas.height);
    const offset = {x:0,y:0};
    const minX = Math.min(...nextPiece.blocks.map(b=>b[0]));
    const minY = Math.min(...nextPiece.blocks.map(b=>b[1]));
    const maxX = Math.max(...nextPiece.blocks.map(b=>b[0]));
    const maxY = Math.max(...nextPiece.blocks.map(b=>b[1]));
    const pieceW = maxX-minX+1;
    const pieceH = maxY-minY+1;
    offset.x = Math.floor((4-pieceW)/2)-minX;
    offset.y = Math.floor((4-pieceH)/2)-minY;
    nextPiece.blocks.forEach(b=>{
      drawCell(b[0]+offset.x,b[1]+offset.y,colors[nextPiece.type],nctx);
    });
  }

  function drop(){
    piece.pos.y++;
    if(collide(arena,piece)){
      piece.pos.y--;
      merge(arena,piece);
      clearLines();
      spawnPiece();
      if(collide(arena,piece)){
        reset();
      }
    }
    dropCounter=0;
  }

  function spawnPiece(){
    piece = nextPiece;
    piece.pos = {x:3,y:-1};
    nextPiece = nextRandomPiece();
  }

  function hardDrop(){
    while(!collide(arena,piece)){
      piece.pos.y++;
    }
    piece.pos.y--;
    merge(arena,piece);
    clearLines();
    spawnPiece();
    if(collide(arena,piece)) reset();
  }

  function update(time=0){
    const delta = time - lastTime;
    lastTime = time;
    if(!paused){
      dropCounter += delta;
      if(dropCounter>dropInterval){
        drop();
      }
      draw();
    }
    requestAnimationFrame(update);
  }

  function move(dir){
    piece.pos.x += dir;
    if(collide(arena,piece)) piece.pos.x -= dir;
  }

  function rotatePiece(){
    const before = piece.blocks.map(p=>p.slice());
    rotate(piece,1);
    if(collide(arena,piece)){
      piece.pos.x++;
      if(collide(arena,piece)){
        piece.pos.x-=2;
        if(collide(arena,piece)){
          piece.pos.x++;
          piece.blocks = before;
          return;
        }
      }
    }
  }

  function reset(){
    arena = createMatrix(cols,rows);
    score = 0; lines = 0; level=1; dropInterval=800;
    newBag();
    nextPiece = nextRandomPiece();
    spawnPiece();
    updateStats();
  }

  document.addEventListener('keydown',e=>{
    if(e.code==='ArrowLeft'){e.preventDefault();move(-1);}
    else if(e.code==='ArrowRight'){e.preventDefault();move(1);}
    else if(e.code==='ArrowDown'){e.preventDefault();piece.pos.y++; if(collide(arena,piece)) piece.pos.y--;}
    else if(e.code==='ArrowUp'){e.preventDefault();rotatePiece();}
    else if(e.code==='Space'){e.preventDefault();hardDrop();}
    else if(e.code==='KeyP'){paused=!paused;}
  });

  document.querySelectorAll('.mobile-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const action=btn.dataset.action;
      if(action==='left') move(-1);
      if(action==='right') move(1);
      if(action==='down'){piece.pos.y++; if(collide(arena,piece)) piece.pos.y--;}
      if(action==='rotate') rotatePiece();
      if(action==='drop') hardDrop();
    });
  });

  document.getElementById('startBtn').onclick=()=>{reset();};
  document.getElementById('pauseBtn').onclick=()=>{paused=!paused;};

  window.addEventListener('resize',resizeCanvas);
  arena = createMatrix(cols,rows);
  newBag();
  nextPiece = nextRandomPiece();
  spawnPiece();
  updateStats();
  resizeCanvas();
  requestAnimationFrame(update);
})();
</script>
</body>
</html>